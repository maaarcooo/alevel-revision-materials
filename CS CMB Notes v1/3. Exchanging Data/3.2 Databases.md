# 3.2 Databases - Revision Notes

## 1. Relational Databases

### Key Terminology
- **Database**: An organised collection of data allowing easy storage, retrieval and management
- **Field**: A single piece of data in a record
- **Record**: A group of related fields representing one data entry
- **Table**: A collection of records with similar structure
- **Entity**: An item of interest about which information is stored (becomes a table in the database)
- **Attribute**: A characteristic of an entity (becomes a field/column)

### Types of Keys

**Primary Key**
- Unique identifier for each record in a table
- Cannot be null
- Usually an ID number
- Shown by underlining

**Foreign Key**
- Attribute that links two tables together
- Exists as a primary key in one table and as a foreign key in another
- Used to create relationships between tables
- Shown using an asterisk (*)

**Compound/Composite Primary Key**
- Combination of 2 or more fields that is unique for all records
- Used when no single field can uniquely identify records

**Secondary Key**
- Field(s) indexed for faster searching
- Allows database to be searched quickly on attributes other than the primary key
- Example: Surname field indexed so patients can be found by name rather than ID

### Flat File vs Relational Database

**Flat File Database**
- Single table storing all data
- Simple but causes data redundancy
- Inefficient storage
- Hard to maintain
- Issues with data consistency

**Relational Database**
- Organises data into multiple tables
- Uses keys to connect related data
- Reduces data redundancy
- Efficient storage
- Easier to maintain
- Ensures data consistency

### Indexing
- Method to store position of each record ordered by a certain attribute
- Primary key automatically indexed
- Secondary keys indexed to make searching faster
- Works like an index in a book - goes directly to relevant data rather than scanning every record

---

## 2. Data Normalisation

**Purpose**: Process of organising database to reduce data duplication and improve accuracy/consistency

**Goals of Normalisation**:
- No redundancy (unnecessary duplicates)
- Consistent data throughout linked tables
- Records can be added/removed without issues
- Complex queries can be carried out

### First Normal Form (1NF)
A table is in 1NF if it has:
1. **Atomic values** - each field contains single, indivisible values (no lists or arrays)
2. **No repeating groups** - no columns containing multiple values
3. **Unique column names** - each column has unique name
4. **Primary key** - unique identifier for each row

### Second Normal Form (2NF)
A table is in 2NF if it:
1. **Is in 1NF**
2. **Only applies to tables with compound primary key**
3. **Has full functional dependency** - all non-key attributes depend on the entire primary key
4. **Has no partial dependencies** - non-key attributes cannot depend on only part of the primary key

### Third Normal Form (3NF)
A table is in 3NF if it:
1. **Is in 2NF**
2. **Has no transitive dependencies** - non-key attributes depend only on primary key, not on other non-key attributes
3. Separate tables created for attributes with transitive dependencies, linked by foreign key

**Important**: For 2NF, table must be in 1NF. For 3NF, table must be in 2NF.

---

## 3. Entity Relationship Diagrams (ERDs)

### Types of Relationships

**One-to-One (1:1)**
- Each entity can only link to one other entity
- Example: Husband and Wife
- Drawn with single line connecting entities

**One-to-Many (1:M)**
- One entity can link to many others
- Example: Mother having multiple children
- Drawn with branch ("crow's foot") on "many" side

**Many-to-Many (M:M)**
- One entity can link to many others and vice versa
- Example: Students and Courses
- Drawn with branches on both sides
- **Cannot be implemented directly** - must be resolved using link table

### Resolving Many-to-Many Relationships
- Create a new **link table** between the two entities
- The link table contains foreign keys from both original tables
- Turns M:M into two 1:M relationships

### ERD Notation (Crow's Feet)
- Entities shown as boxes with entity name inside
- Relationships shown as lines connecting boxes
- Single line = one
- Crow's foot (branch) = many

---

## 4. Capturing, Selecting, Managing & Exchanging Data

### Capturing Data

**Forms**
- Collect user input in structured format
- Common in web applications

**OMR (Optical Mark Recognition)**
- Detects marked areas on paper
- Used for: exams, surveys, lottery tickets
- Automates data collection

**OCR (Optical Character Recognition)**
- Converts printed/handwritten text to digital format
- Useful for digitising documents
- Assists in searching and editing text

**Sensors**
- Detect and respond to environmental changes
- Convert physical signals to digital data
- Types: temperature, pressure, proximity, light, motion, humidity, gas, force, acoustic, magnetic

**Barcodes**
- Machine-readable representation of data using parallel lines (1D) or patterns (2D)
- Used for: tracking items, inventory management, point-of-sale
- Fast and accurate data entry
- Reduces human error

**Data Mining**
- Discovering patterns and insights from large datasets
- Uses machine learning, statistics and AI
- Applications: marketing, finance, healthcare, manufacturing, telecommunications

### Selecting Data - Query By Example (QBE)

**Features**:
- User-friendly visual interface (grid/form-based)
- No need to learn complex query syntax
- Users enter criteria in columns representing fields
- System translates to SQL automatically

**Operations**:
- Filtering: specify conditions to retrieve specific records
- Sorting: indicate ascending/descending order
- Joining: combine data from multiple tables
- Aggregation: count, average, sum values

**Benefits**: Easy to learn, visual, accessible for non-technical users
**Drawbacks**: Less powerful than SQL, may not support advanced features, can be slower for large datasets

### Managing Data
- Add new data
- Edit/modify existing data
- Delete data
- Achieved using: SQL (Database Manipulation Language) or DBMS built-in facilities

### Exchanging Data

**CSV (Comma Separated Values)**
- Simple text format
- Stores tabular data
- Uses commas to separate values
- Widely supported

**JSON (JavaScript Object Notation)**
- Lightweight data interchange format
- Human-readable
- Uses key-value pairs
- Common in web applications

**EDI (Electronic Data Interchange)**
- Standardised electronic communication
- Transfers documents between businesses
- Reduces paper usage
- Streamlines transactions

**APIs (Application Programming Interfaces)**
- Protocols allowing software applications to communicate
- Enables integration of different services
- Facilitates data exchange between applications
- Types: RESTful, SOAP

**Memory Sticks**
- Portable USB flash drives
- Easy plug-and-play
- Compact and durable
- Limited capacity vs external drives
- Risk of data loss through damage/theft

**Email**
- Electronic communication system
- Fast, convenient, organised
- Supports file attachments
- Security risks: phishing, spam, data breaches
- File size limitations

---

## 5. SQL (Structured Query Language)

### Selecting Data (Single Table)

**Basic Commands**:
```sql
SELECT field1, field2
FROM table_name
WHERE condition
```

**SELECT** - Retrieves data from table
- `SELECT *` - selects all fields
- `SELECT field1, field2` - selects specific fields

**FROM** - Specifies which table to retrieve from

**WHERE** - Filters data based on condition
- Comparison operators: `=`, `>`, `<`, `>=`, `<=`, `<>`
- Logical operators: `AND`, `OR`, `NOT`

**LIKE** - Pattern matching
- `%` wildcard represents any characters
- Example: `WHERE name LIKE 'J%'` (names starting with J)

**ORDER BY** - Sorts results
- Default: ascending order
- `DESC` for descending
- Example: `ORDER BY age DESC`

### Selecting Data (Multiple Tables)

**Nested SELECT**
- SELECT within another SELECT
```sql
SELECT * FROM users 
WHERE age > (SELECT AVG(age) FROM users);
```

**JOIN (INNER JOIN)**
- Combines data from multiple tables based on related column
```sql
SELECT users.name, orders.order_id 
FROM users
JOIN orders ON users.user_id = orders.user_id;
```

### Inserting Data

**INSERT INTO**
```sql
INSERT INTO table_name (column1, column2)
VALUES (value1, value2);
```

### Deleting Records

**DELETE**
```sql
DELETE FROM table_name
WHERE condition;
```
- **Warning**: Without WHERE clause, deletes ALL records

### Deleting Tables

**DROP TABLE**
```sql
DROP TABLE table_name;
```
- Permanently deletes entire table and all data

### Data Types
- **CHAR(n)**: Fixed length string
- **VARCHAR(n)**: Variable length string (max n)
- **BOOLEAN**: TRUE or FALSE
- **INTEGER/INT**: Whole number
- **FLOAT**: Decimal number
- **DATE**: Date (DD/MM/YYYY)
- **TIME**: Time (HH:MM:SS)
- **CURRENCY**: Monetary amount

---

## 6. Referential Integrity

**Definition**: Ensures consistency between related tables in a relational database

**Key Principle**: Foreign key value must either:
- Match a primary key value in the related table, OR
- Be null (if allowed)

**Foreign Key Constraints**:
- Prevents orphaned records (foreign keys with no matching primary key)
- Maintains valid relationships

### Cascade Actions

**CASCADE**
- Automatically updates/deletes related records
- Example: Deleting customer also deletes their orders

**SET NULL**
- Sets foreign key to null in related records
- Preserves records but removes relationship

**SET DEFAULT**
- Sets foreign key to default value

**NO ACTION/RESTRICT**
- Prevents changes if related records exist
- Must manually handle related records first

### Benefits and Drawbacks

**Benefits**:
- Ensures data consistency and accuracy
- Prevents orphaned records
- Maintains database integrity

**Drawbacks**:
- Can impact performance (additional checks)
- Requires careful planning and design

---

## 7. Transaction Processing

### What is a Transaction?
- Sequence of database operations treated as single unit of work
- Example: Money transfer = withdraw from one account + deposit to another
- Both operations must complete together or neither should happen

### Problems in Transaction Processing

**Concurrency**
- Multiple transactions accessing same data simultaneously
- Can lead to inconsistencies

**Deadlock**
- Two or more transactions waiting for each other to release resources
- Causes indefinite waiting

**Data Integrity**
- Transactions may leave database inconsistent if they fail mid-execution

**Isolation**
- One user's transaction affecting another user's transaction

**Durability**
- System failure after transaction confirmed may cause data loss

### Solutions

**Locking**
- Prevents multiple transactions accessing same data simultaneously
- Types: shared locks (read), exclusive locks (write)

**Deadlock Prevention/Detection**
- Order resource requests
- Implement timeout mechanisms

**Logging and Recovery**
- Keep log of all changes
- Can recover to consistent state after crash

**Commit and Rollback**
- **Commit**: Saves all changes permanently
- **Rollback**: Reverts changes made in transaction

**Two-Phase Commit Protocol**
- For distributed systems
- Ensures transaction committed in all nodes or none

---

## 8. ACID Properties

**ACID** = Set of rules DBMS must follow to ensure data integrity

### Atomicity
- **"All or Nothing"**
- All operations in transaction succeed or fail as whole
- If any operation fails, entire transaction is rolled back
- No partial transactions occur

### Consistency
- Data remains in consistent state after transactions
- Transactions must follow database rules and constraints
- Starts with consistent state, ends with consistent state

### Isolation
- Transactions isolated from each other
- Intermediate states not visible to other transactions
- Prevents conflicts and data inconsistencies
- Each transaction appears to execute alone

### Durability
- Committed transactions persist even if system fails
- Data not lost once transaction complete
- Changes permanently saved to non-volatile storage

---

## 9. Record Locking

**Purpose**: Prevents conflicting access to data by multiple transactions

### Types of Locks

**Shared Lock (Read Lock)**
- Allows multiple transactions to read record simultaneously
- Prevents modifications/deletions until lock released
- Multiple readers can coexist

**Exclusive Lock (Write Lock)**
- Only one transaction can access and modify record
- Blocks other transactions from reading or writing
- Ensures single writer

### Benefits
- Maintains data consistency and integrity
- Prevents conflicting modifications
- Allows concurrent read access without compromising consistency
- Improves database performance

### Deadlock Problem
**Example**:
- User 1 locks Customer 1's record
- User 2 locks Customer 2's record
- User 1 tries to access Customer 2 (locked by User 2)
- User 2 tries to access Customer 1 (locked by User 1)
- Both wait indefinitely = **deadlock**

**Solutions**:
- Timeout mechanisms
- Deadlock detection algorithms
- Resource ordering

---

## 10. Redundancy

**Definition**: Same data stored in multiple places in database

**Causes**:
- Poor database design
- Unnormalised tables
- Accidental duplication

**Problems**:
- **Inconsistencies**: If data updated in one place but not others
- **Wasted storage space**: Same data stored multiple times
- **Update anomalies**: Difficulty maintaining consistent data

**Solutions**:
- **Normalisation**: Organise database to reduce redundancy
- **Relational design**: Use foreign keys to link data instead of duplicating
- **Regular audits**: Check for and remove duplicate data

**Note**: Some redundancy may be intentional for performance (e.g., caching) but must be carefully managed

---

## Key Exam Tips

1. **For Normalisation questions**: Always state that 2NF requires 1NF, and 3NF requires 2NF
2. **For SQL**: Practice writing queries without looking at notes - common exam question
3. **For ERDs**: Remember crow's foot points to "many" side
4. **For ACID**: Use real-world examples like money transfers to explain concepts
5. **Primary keys**: Underline them
6. **Foreign keys**: Mark with asterisk (*)
7. **Many-to-many relationships**: Must always be resolved with link table
8. **Referential integrity**: Explain using cascaded deletes/updates
9. **Transaction processing**: Focus on why ACID properties matter in multi-user environments
