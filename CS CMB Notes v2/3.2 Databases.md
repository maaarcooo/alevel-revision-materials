# 3.2 Databases

## Specification Coverage
- 1.3.2 a) Relational Database, Flat File, Primary/Foreign/Secondary Keys, Entity Relationship Modelling, Normalisation, Indexing
- 1.3.2 b) Methods of capturing, selecting, managing, and exchanging data
- 1.3.2 c) Normalisation
- 1.3.2 d) SQL
- 1.3.2 e) Referential Integrity
- 1.3.2 f) Transaction processing, ACID, Record locking, Redundancy

---

## 1. Database Fundamentals

### What is a Database?
A **database** is an organised collection of data that allows easy **storage, retrieval, and management** of information.

**Benefits of electronic databases:**
- Easier to add, delete, modify and update data
- Data can be backed up and copied easily
- Multiple users from multiple locations can access the same database simultaneously

### Key Terminology

| Term | Definition |
|------|------------|
| **Field** | A single piece of data in a record |
| **Record** | A group of related fields representing one data entry (a row) |
| **Table** | A collection of records with a similar structure |
| **Entity** | An item of interest about which information is stored |
| **Attribute** | A characteristic of an entity; categories about which data is collected |
| **DBMS** | Database Management System - software used to manage databases (e.g., MySQL, Oracle, PostgreSQL) |

---

## 2. Flat File vs Relational Database

### Flat File Database
A **flat file** is a database consisting of a **single file/table**, typically based around a **single entity and its attributes**.

**Notation format:**
```
EntityName(PrimaryKey, Attribute1, Attribute2, ...)
```

**Example:**
```
Car(CarID, Age, Price)
```

**Limitations of flat files:**
- Causes **data redundancy** (unnecessary duplicate data)
- **Inefficient storage**
- Harder to maintain
- Data inconsistencies if updates are missed

### Relational Database
A **relational database** organises data into **multiple tables** that recognise differences between entities. Tables are linked using **keys** to connect related data.

**Advantages:**
- Reduces data redundancy
- Makes efficient use of storage
- Easier to maintain
- Ensures data consistency

---

## 3. Database Keys

### Primary Key
A **primary key** is a **unique identifier** for each record in a table. It is always different for each row and is denoted by **underlining** in notation.

**Example:** `StudentID`, `OrderID`, `CustomerID`

### Composite (Compound) Primary Key
A **composite primary key** is a combination of **two or more fields** that together uniquely identify each record. Used when no single field can guarantee uniqueness.

### Foreign Key
A **foreign key** is an attribute that **links two tables together**. It exists as the primary key in one table and acts as a foreign key in another. Denoted by an **asterisk (*)** in notation.

**Example:** In a Patient table, `DoctorID*` links to the Doctor table where `DoctorID` is the primary key.

### Secondary Key
A **secondary key** is a field that is **indexed for faster searching**. It allows ordering and searching on commonly queried attributes.

**Example:** Surname field indexed as a secondary key because patients are unlikely to remember their PatientID but will know their surname.

---

## 4. Indexing

**Indexing** is a technique used to **speed up data retrieval** in a database. It works like a book index - instead of searching every record sequentially, the DBMS can go directly to relevant records.

- The **primary key is automatically indexed**
- **Secondary keys** are indexed on frequently searched attributes
- Greatly improves search performance on large databases

---

## 5. Entity Relationship Modelling

### Relationship Types

| Type | Description | Example | Notation |
|------|-------------|---------|----------|
| **One-to-One (1:1)** | Each entity links to exactly one other entity | Husband ↔ Wife | Single line on both ends |
| **One-to-Many (1:M)** | One entity links to many others | Doctor → Patients, Mother → Children | Line with crow's foot on "many" side |
| **Many-to-Many (M:M)** | Multiple entities link to multiple others | Students ↔ Courses | Crow's feet on both sides |

### Entity Relationship Diagrams (ERD)
ERDs represent entities (tables) and relationships between them using **crow's foot notation**.

**Key points:**
- Entities are drawn as boxes with the entity name inside
- Relationships are shown using lines with crow's foot notation
- When an entity has a "many" relationship, it will contain a **foreign key**

### Resolving Many-to-Many Relationships
**Many-to-many relationships cannot be directly implemented** in a database. They must be resolved by creating a **link table** (junction table) between the two entities, converting the M:M into two 1:M relationships.

---

## 6. Normalisation

**Normalisation** is the process of organising a database to achieve the **best possible layout**, reducing duplication and improving data accuracy and consistency.

### Goals of Normalisation
- **No redundancy** (unnecessary duplicates)
- **Consistent data** throughout linked tables
- Records can be **added and removed without issues**
- **Complex queries** can be carried out

### First Normal Form (1NF)
A table is in 1NF if:
- All data is **atomic** (each field contains single, indivisible values)
- **No repeating groups** (columns must not contain arrays or lists)
- Each column has a **unique name**
- Has a **unique identifier (primary key)**

### Second Normal Form (2NF)
A table is in 2NF if:
- It is already in **1NF**
- Only applies to tables with a **composite primary key**
- Has **no partial dependencies** - all non-key attributes must depend on the **entire** primary key, not just part of it

**Example of violation:** In a table with composite key (CourseCode, Date), if CourseTitle depends only on CourseCode, this is a partial dependency.

### Third Normal Form (3NF)
A table is in 3NF if:
- It is already in **2NF**
- Has **no transitive dependencies** - non-key attributes must not depend on other non-key attributes
- Each non-key attribute depends **solely on the primary key**

**Example of violation:** If Certificate depends on Title (not the primary key), this is a transitive dependency.

> **Exam Tip:** For a table to be in 2NF, it must be in 1NF. For a table to be in 3NF, it must be in 2NF. Always state this requirement when explaining normalisation forms.

---

## 7. Capturing, Selecting, Managing & Exchanging Data

### Methods of Capturing Data

| Method | Description | Use Case |
|--------|-------------|----------|
| **Forms** | Collect user input in structured format | Web applications, surveys |
| **OMR** (Optical Mark Recognition) | Detects marked areas on paper using special machines | Exams, surveys, lottery tickets |
| **OCR** (Optical Character Recognition) | Converts printed/handwritten text to digital format | Digitising documents |
| **MICR** (Magnetic Ink Character Recognition) | Reads special magnetic ink characters | Bank cheques |
| **Sensors** | Detect and respond to environmental changes | Temperature, pressure, motion detection |
| **Barcodes** | Machine-readable parallel lines (1D) or geometric patterns (2D/QR) | Inventory tracking, point-of-sale |
| **Data Mining** | Discovering hidden patterns from large datasets | Marketing, fraud detection, healthcare |

### Selecting Data

**Query By Example (QBE):**
- User-friendly **visual interface** for constructing queries
- Users enter criteria in columns without learning SQL syntax
- Translates input into SQL queries automatically

**Benefits:** Easy to learn, visual interface, accessible for non-technical users
**Drawbacks:** Less powerful than SQL, may not support advanced features

### Managing Data
After creation, databases need facilities to:
- **Add** new data
- **Edit/modify** existing data
- **Delete** data

This is achieved through **Database Manipulation Language (DML)** such as SQL or built-in DBMS facilities.

### Exchanging Data

| Format | Description |
|--------|-------------|
| **CSV** (Comma Separated Values) | Simple plain text format using commas to separate values |
| **JSON** (JavaScript Object Notation) | Lightweight, human-readable format using key-value pairs |
| **EDI** (Electronic Data Interchange) | Standardised electronic transfer between businesses without human interaction |
| **APIs** (Application Programming Interfaces) | Protocols allowing different software to communicate |
| **Memory sticks** | Portable USB flash drives for physical data transfer |
| **Email** | Electronic messaging with file attachments |

---

## 8. SQL (Structured Query Language)

**SQL** is a **declarative programming language** used to manipulate databases. It enables creating, removing, updating, and querying databases.

### Data Retrieval Commands

#### SELECT, FROM, WHERE
```sql
SELECT field1, field2
FROM TableName
WHERE condition;
```

**Wildcards:**
- `*` - Selects all columns
- `%` - Used with LIKE for pattern matching

**Examples:**
```sql
-- Select all fields from Customers
SELECT * FROM Customers;

-- Select specific fields with condition
SELECT Name, Age FROM Customers WHERE Age > 25;

-- Pattern matching (names starting with 'J')
SELECT * FROM Customers WHERE Name LIKE 'J%';
```

#### Logical Operators
```sql
-- AND: Both conditions must be true
SELECT * FROM Users WHERE Age > 18 AND City = 'London';

-- OR: At least one condition must be true
SELECT * FROM Users WHERE City = 'London' OR City = 'Paris';

-- BETWEEN: Range of values
SELECT * FROM Movies WHERE DatePublished BETWEEN #01/01/2000# AND #31/12/2005#;
```

#### ORDER BY
```sql
-- Ascending order (default)
SELECT * FROM Customers ORDER BY Surname;

-- Descending order
SELECT * FROM Customers ORDER BY Age DESC;
```

#### JOIN (INNER JOIN)
Combines rows from multiple tables based on a **common field**.
```sql
SELECT Movie.MovieTitle, Director.DirectorName
FROM Movie
JOIN Director ON Movie.DirectorName = Director.DirectorName;
```

#### Nested SELECT
A SELECT statement within another SELECT.
```sql
SELECT * FROM Employees
WHERE Salary > (SELECT AVG(Salary) FROM Employees);
```

### Data Definition Commands

#### CREATE TABLE
```sql
CREATE TABLE TableName
(
    Attribute1 INTEGER NOT NULL PRIMARY KEY,
    Attribute2 VARCHAR(20) NOT NULL,
    Attribute3 DATE
);
```

**SQL Data Types:**

| Type | Description |
|------|-------------|
| `CHAR(n)` | Fixed-length string of n characters |
| `VARCHAR(n)` | Variable-length string with maximum n characters |
| `BOOLEAN` | TRUE or FALSE |
| `INTEGER/INT` | Whole number |
| `FLOAT` | Decimal number |
| `DATE` | Date (Day/Month/Year) |
| `TIME` | Time (Hour/Minute/Second) |
| `CURRENCY` | Monetary amount |

#### ALTER TABLE
```sql
-- Add a column
ALTER TABLE TableName ADD ColumnName DataType;

-- Delete a column
ALTER TABLE TableName DROP COLUMN ColumnName;

-- Modify column data type
ALTER TABLE TableName MODIFY COLUMN ColumnName NewDataType;
```

### Data Manipulation Commands

#### INSERT INTO
```sql
INSERT INTO TableName (Column1, Column2)
VALUES ('Value1', 'Value2');
```

#### UPDATE
```sql
UPDATE TableName
SET Column1 = 'NewValue'
WHERE Condition;
```

#### DELETE
```sql
-- Delete specific records
DELETE FROM TableName WHERE Condition;

-- Example
DELETE FROM Song WHERE Artist = 'RandomBits';
```

#### DROP TABLE
```sql
DROP TABLE TableName;
```

---

## 9. Referential Integrity

**Referential integrity** ensures **consistency** between related tables in a relational database by maintaining valid relationships between primary and foreign keys.

### Key Rules
- A foreign key value must either:
  - **Match a primary key value** in the related table, OR
  - Be **NULL** (if allowed)
- Prevents **orphaned records** (foreign keys pointing to non-existent primary keys)

### Cascade Actions

| Action | Effect |
|--------|--------|
| **CASCADE** | Automatically updates/deletes related records |
| **SET NULL** | Sets foreign key to NULL in related records |
| **SET DEFAULT** | Sets foreign key to its default value |
| **NO ACTION/RESTRICT** | Prevents changes if related records exist |

**Benefits:** Ensures data consistency, prevents orphaned records
**Drawbacks:** Can impact performance, requires careful planning

---

## 10. Transaction Processing

A **transaction** is a sequence of database operations treated as a **single unit of work**.

### Problems in Transaction Processing

| Problem | Description |
|---------|-------------|
| **Concurrency** | Multiple transactions accessing/modifying same data simultaneously |
| **Deadlock** | Two or more transactions waiting for each other to release resources |
| **Data Integrity** | Transactions failing mid-execution leaving inconsistent state |
| **Isolation** | One user's transaction affecting another's |
| **Durability** | System failure after transaction confirmation causing data loss |

### ACID Properties

All DBMS must follow ACID rules to ensure **data integrity**.

| Property | Description |
|----------|-------------|
| **Atomicity** | Transaction must complete **entirely or not at all**. If any operation fails, the entire transaction is rolled back. No partial transactions. |
| **Consistency** | Transaction must maintain **referential integrity rules**. Database starts and ends in a consistent state. |
| **Isolation** | Transactions are **isolated from each other**. Intermediate states are not visible to other transactions. |
| **Durability** | Once committed, transactions **persist permanently**, even after system failures (e.g., power cuts). |

### Record Locking

**Record locking** prevents **conflicting access** to data by multiple transactions, ensuring data consistency and integrity.

**Types of Locks:**

| Lock Type | Description |
|-----------|-------------|
| **Shared Lock (Read Lock)** | Allows multiple transactions to read simultaneously, but prevents modifications |
| **Exclusive Lock (Write Lock)** | Only one transaction can access and modify; blocks all other access |

**Deadlock Example:**
1. User 1 locks Customer 1's record; User 2 locks Customer 2's record
2. User 1 tries to access Customer 2; User 2 tries to access Customer 1
3. Both wait indefinitely for the other to release → **Deadlock**

**Solutions:**
- Deadlock prevention/detection algorithms
- Timeout mechanisms
- Resource ordering

### Redundancy

**Redundancy** in databases can mean:

1. **Undesirable redundancy:** Same data stored in multiple places accidentally
   - Leads to inconsistencies
   - Wastes storage space
   - Addressed through normalisation

2. **Backup redundancy:** Intentionally storing **copies of data in physically different locations**
   - Ensures data recovery if one copy is damaged
   - Critical for important/sensitive data

---

## Exam Tips

1. **SQL Syntax:** Ensure correct use of quotation marks for string values and # symbols for dates in some SQL dialects.

2. **Normalisation Questions:** Always state the prerequisite forms (e.g., "The table is in 3NF because it is in 2NF and has no transitive dependencies").

3. **ERD Questions:** Remember that the entity with the "many" side of a relationship contains the foreign key.

4. **ACID Questions:** When explaining atomicity in context, give specific examples of what would happen if a transaction partially completed.

5. **Key Identification:** Primary keys are underlined; foreign keys are marked with an asterisk (*).
